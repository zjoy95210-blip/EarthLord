# EarthLord 产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2025-12-26
**产品名称**: EarthLord（地球领主）
**平台**: iOS

---

## 1. 产品概述

### 1.1 产品定位
EarthLord 是一款基于真实地理位置（LBS）的末日生存策略游戏。玩家通过在现实世界中行走来圈占领地、探索废墟获取资源、建造设施发展基地，并与其他幸存者进行交易和通讯。

### 1.2 产品愿景
打造一款"Walk to Earn"（走路即赚取）的沉浸式生存游戏，将虚拟游戏与现实运动结合，让玩家在健康运动的同时享受末日生存的策略乐趣。

### 1.3 目标用户
- **核心用户**: 18-35岁的游戏玩家，喜欢策略/生存类游戏
- **次要用户**: 热爱户外运动、跑步健身的人群
- **潜在用户**: 《宝可梦GO》、Keep、跑步类App的用户

### 1.4 商业目标
- 通过订阅制（月卡）和一次性购买（资源包）实现变现
- 面向全球175个国家和地区的App Store用户
- 支持多语言（简体中文、繁体中文、英文）

---

## 2. 功能需求

### 2.1 用户系统模块

#### 2.1.1 登录注册
**优先级**: P0（核心功能）

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| AUTH-001 | 邮箱注册登录 | 支持邮箱+密码注册，包含邮箱验证 |
| AUTH-002 | Apple登录 | 一键OAuth登录，符合Apple审核要求 |
| AUTH-003 | Google登录 | 支持海外用户Google账号登录 |
| AUTH-004 | 会话管理 | 支持多设备登录，自动续期token |
| AUTH-005 | 密码重置 | 支持邮箱找回密码功能 |

**技术依赖**: Supabase Auth

#### 2.1.2 个人主页
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| PROFILE-001 | 开拓者档案 | 展示幸存者等级、存活天数 |
| PROFILE-002 | 领地统计 | 显示领地数量、总面积 |
| PROFILE-003 | 建筑统计 | 显示建筑总数量 |

---

### 2.2 圈地系统模块

#### 2.2.1 GPS圈地
**优先级**: P0（核心功能）

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| GPS-001 | 实时GPS定位 | 获取用户精确位置，误差<10米 |
| GPS-002 | 轨迹绘制 | 用户移动时在地图上绘制蓝色轨迹线 |
| GPS-003 | 轨迹闭合 | 回到起点附近（20米内）自动闭合成多边形 |
| GPS-004 | 面积计算 | 闭合后计算并显示领地面积（平方米） |
| GPS-005 | 合法性验证 | 检测作弊行为、与他人领地重叠 |
| GPS-006 | 领地确权 | 验证通过后永久归属用户 |

**技术依赖**: Apple MapKit、CoreLocation

#### 2.2.2 领地管理
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| LAND-001 | 领地命名 | 用户可自定义领地名称 |
| LAND-002 | 领地详情 | 显示名称、面积、建筑数量 |
| LAND-003 | 交易开关 | 可开启/关闭"允许交易"功能 |
| LAND-004 | 活跃度规则 | 30天内开始建设，90天保持活跃，否则回收 |

**技术依赖**: Supabase Database、PostGIS

---

### 2.3 探索系统模块

#### 2.3.1 POI发现与搜刮
**优先级**: P0（核心功能）

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| POI-001 | POI识别 | 自动识别附近的医院、超市、工厂等真实地标 |
| POI-002 | 距离触发 | 进入POI 50米范围内触发发现提示 |
| POI-003 | 搜刮功能 | 点击搜刮按钮获取对应资源 |
| POI-004 | 资源映射 | 医院→药品，超市→食物，工厂→金属，公园→木材，银行→稀有材料 |
| POI-005 | 冷却机制 | 同一POI搜刮后进入冷却时间 |
| POI-006 | 探索统计 | 记录探索距离、时长、获得物品 |

**技术依赖**: Apple MapKit POI API

#### 2.3.2 背包系统
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| BAG-001 | 容量限制 | 默认背包容量100格 |
| BAG-002 | 物品展示 | 分类展示物品名称、数量、图标 |
| BAG-003 | 容量提示 | 显示当前使用量/总容量进度条 |
| BAG-004 | 物品使用 | 支持使用消耗品（食物、药品等） |
| BAG-005 | 本地缓存 | 支持离线查看，网络恢复后同步 |

**技术依赖**: SwiftData/CoreData（本地）、Supabase（云端）

---

### 2.4 建造系统模块

#### 2.4.1 建筑建造
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| BUILD-001 | 建筑目录 | 展示15种建筑，分4类：生存、储存、生产、能源 |
| BUILD-002 | 配方展示 | 显示建造所需资源及当前拥有量 |
| BUILD-003 | 资源校验 | 资源不足时提示，足够时扣除资源 |
| BUILD-004 | 位置选择 | 在领地内拖拽选择建筑位置 |
| BUILD-005 | 建造进度 | 建筑有建造时间，显示进度 |

#### 2.4.2 建筑状态管理
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| STATE-001 | 状态机 | 支持状态：建造中→待激活→运行中→损坏 |
| STATE-002 | 激活操作 | 待激活状态可点击激活 |
| STATE-003 | 升级功能 | 运行中状态可升级，消耗资源 |
| STATE-004 | 维修功能 | 损坏状态可维修 |

---

### 2.5 交易系统模块

**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| TRADE-001 | 发布挂单 | 选择"我提供"和"我需要"的物品发布 |
| TRADE-002 | 位置限制 | 需进入对方领地100米范围才能看到挂单 |
| TRADE-003 | 接受交易 | 点击接受后双方物品自动交换 |
| TRADE-004 | 交易记录 | 保存历史交易记录 |

---

### 2.6 通讯系统模块

#### 2.6.1 消息中心
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| MSG-001 | 官方消息 | 接收生存指南、每日任务、官方公告 |
| MSG-002 | 系统通知 | 接收交易请求、领地被入侵等通知 |
| MSG-003 | 消息状态 | 已读/未读标记 |

#### 2.6.2 公共频道
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| CHAT-001 | 位置聊天 | 3km范围内玩家可互相发消息 |
| CHAT-002 | 实时推送 | 新消息秒级送达 |
| CHAT-003 | 消息历史 | 支持查看历史消息 |

#### 2.6.3 频道管理
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| CHAN-001 | 创建频道 | 用户可创建私人频道 |
| CHAN-002 | 加入/退出 | 支持加入和退出频道 |
| CHAN-003 | 频道列表 | 展示附近频道、在线人数 |

#### 2.6.4 PTT呼叫
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| PTT-001 | 长按发送 | 长按麦克风录音，松开发送 |
| PTT-002 | 语音播放 | 接收方自动播放语音 |

#### 2.6.5 通讯设备等级
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| DEV-001 | 收音机 | 默认设备，只能接收 |
| DEV-002 | 对讲机 | 收发功能，3km范围 |
| DEV-003 | 营地电台 | 10km范围 |
| DEV-004 | 卫星通讯 | 全球范围 |

**技术依赖**: Supabase Realtime

---

### 2.7 成长系统模块

#### 2.7.1 排行榜
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| RANK-001 | 领地面积榜 | 按总领地面积排名 |
| RANK-002 | 探索废墟榜 | 按搜刮次数排名 |
| RANK-003 | 建筑数量榜 | 按建筑总数排名 |
| RANK-004 | 我的排名 | 显示当前用户排名 |

#### 2.7.2 成就系统
**优先级**: P2

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| ACH-001 | 成就列表 | 展示所有成就及完成状态 |
| ACH-002 | 成就分类 | 新手、进阶、稀有成就 |
| ACH-003 | 稀有度 | 普通→稀有→史诗→传说 |
| ACH-004 | 奖励发放 | 完成成就自动发放金币奖励 |

#### 2.7.3 生存体征
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| VITAL-001 | 核心生命 | 最大100，降到0死亡 |
| VITAL-002 | 饱食度 | 每小时自动-5 |
| VITAL-003 | 水分 | 每小时自动-10 |
| VITAL-004 | 消耗物品 | 使用食物/水恢复对应数值 |
| VITAL-005 | 增益机制 | 饱食度/水分>80%时获得增益 |

---

### 2.8 商业化模块

#### 2.8.1 付费订阅
**优先级**: P0（核心功能）

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| PAY-001 | 开拓者月卡 | $9.99/月，无限探索、范围扩大 |
| PAY-002 | 领主通行证 | $19.99/月，所有特权 |
| PAY-003 | 自动续费 | 支持订阅自动续费 |
| PAY-004 | 订阅管理 | 可查看、取消订阅 |

#### 2.8.2 一次性购买
**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| SHOP-001 | 初级物资包 | $0.99 |
| SHOP-002 | 中级物资包 | $2.99 |
| SHOP-003 | 稀有资源包 | $9.99 |

**技术依赖**: StoreKit 2

---

### 2.9 系统设置模块

**优先级**: P1

| 需求ID | 功能描述 | 验收标准 |
|--------|----------|----------|
| SET-001 | 多语言 | 支持简体中文、繁体中文、English |
| SET-002 | 语言切换 | 切换后重启App生效 |
| SET-003 | 通知设置 | 可开关推送通知 |

---

## 3. 非功能性需求

### 3.1 性能需求
- GPS定位响应时间 < 1秒
- 地图加载时间 < 2秒
- 排行榜查询响应时间 < 500ms（支持10万用户）
- App启动时间 < 3秒

### 3.2 安全需求
- 用户密码加密存储
- OAuth认证遵循行业标准
- GPS轨迹防作弊检测
- 敏感数据传输使用HTTPS

### 3.3 可用性需求
- 支持iOS 15.0及以上版本
- 支持离线查看背包、领地信息
- 网络恢复后自动同步数据

### 3.4 合规需求
- 符合Apple App Store审核指南
- 遵循GDPR数据隐私规范
- 内购遵循苹果IAP政策

---

## 4. 数据库设计概要

| 表名 | 用途 | 关键字段 |
|------|------|----------|
| users | 用户信息 | id, email, nickname, created_at |
| territories | 领地信息 | id, user_id, name, geometry(PostGIS), area |
| buildings | 建筑信息 | id, territory_id, type, status, level |
| items | 物品/背包 | id, user_id, item_type, quantity |
| trades | 交易记录 | id, seller_id, buyer_id, items, status |
| messages | 消息记录 | id, channel_id, user_id, content, created_at |
| achievements | 成就记录 | id, user_id, achievement_type, unlocked_at |
| vital_signs | 生存体征 | id, user_id, health, hunger, thirst |

**技术依赖**: Supabase PostgreSQL + PostGIS扩展

---

## 5. 技术架构

```
┌─────────────────────────────────────────────────────┐
│                    iOS App (Swift)                   │
├─────────────────────────────────────────────────────┤
│  UI Layer: SwiftUI                                   │
│  Map: Apple MapKit                                   │
│  Location: CoreLocation                              │
│  Payment: StoreKit 2                                 │
│  Local Storage: SwiftData                            │
├─────────────────────────────────────────────────────┤
│                   Supabase Backend                   │
├─────────────────────────────────────────────────────┤
│  Auth: Supabase Auth (OAuth, Email)                  │
│  Database: PostgreSQL + PostGIS                      │
│  Realtime: Supabase Realtime (WebSocket)            │
│  Storage: Supabase Storage (Images)                  │
└─────────────────────────────────────────────────────┘
```

---

## 6. 里程碑规划

| 阶段 | 功能范围 | 交付物 |
|------|----------|--------|
| MVP 1.0 | 登录、GPS圈地、领地管理 | 可圈地的基础版本 |
| 1.1 | POI探索、背包系统 | 可探索搜刮 |
| 1.2 | 建造系统、交易系统 | 完整资源循环 |
| 1.3 | 通讯系统 | 社交功能 |
| 1.4 | 成就、排行榜、生存体征 | 成长系统 |
| 2.0 | 付费订阅、多语言 | 商业化版本 |

---

## 7. 风险与依赖

| 风险项 | 影响 | 缓解措施 |
|--------|------|----------|
| GPS精度不足 | 圈地体验差 | 增加容错范围，提供手动调整 |
| 地图POI数据不全 | 探索内容少 | 补充虚拟POI点 |
| 作弊问题 | 破坏游戏平衡 | 多维度反作弊检测 |
| 苹果审核 | 上架延迟 | 提前熟悉审核指南 |

---

**文档结束**
